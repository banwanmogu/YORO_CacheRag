# ğŸ§ YORO â€”â€”you only rag onceâ€”â€” LRUç¼“å­˜ â€”â€” é¢å¯¹ç°å®åœºæ™¯é‡å¤é—®é¢˜ï¼Œä»…éœ€ragä¸€æ¬¡ï¼â€”â€”åŠ¨æ€ç¼“å­˜æ›¿æ¢ç®—æ³•

[ğŸ‡¨ğŸ‡³ ä¸­æ–‡](README.md) | [ğŸ‡ºğŸ‡¸ English](README_ENG.md)


<div align="center">
  <img src="image-2.png" width="300" alt="YORO Logo" />
   </div>

# ä¸ºä»€ä¹ˆä½¿ç”¨ YOROï¼Ÿ

## 1ï¸âƒ£ ç¼“å­˜
åœ¨ä¼ä¸šçº§çœŸå®åœºæ™¯ä¸­ï¼ˆå¦‚å®¢æœæœºå™¨äººã€æ–‡æ¡£è§£é‡ŠåŠ©æ‰‹ï¼‰ï¼Œç”¨æˆ·éœ€è¦çš„ä¿¡æ¯å¾€å¾€é›†ä¸­åœ¨åŒä¸€ä¸ªæ®µè½ä¸­ã€‚

### æ™®é€š RAG ç¤ºä¾‹
- **Q1**ï¼šYORO ä½œè€… mogu ä»Šå¹´å¤šå°‘å²ï¼Ÿ  
  â†’ æ¨¡å‹è°ƒç”¨ RAGï¼ŒæŸ¥è¯¢åˆ°ï¼šmogu ä»Šå¹´ 23 å²ã€‚
- **Q2**ï¼šYORO ä½œè€… mogu ç›®å‰å±…ä½åœ¨å“ªï¼Ÿ  
  â†’ æ¨¡å‹å†æ¬¡è°ƒç”¨ RAGï¼ŒæŸ¥è¯¢åˆ°ï¼šmogu ç›®å‰å±…ä½åœ¨æ—¥æœ¬ã€‚
- **Q3**ï¼šYORO ä½œè€… mogu æ˜¯ç¨‹åºå‘˜å—ï¼Ÿ  
  â†’ æ¨¡å‹å†æ¬¡è°ƒç”¨ RAGï¼ŒæŸ¥è¯¢åˆ°ï¼šmogu æ˜¯ä¸€ä¸ªç¨‹åºå‘˜ã€‚

âš ï¸ **é—®é¢˜**ï¼šéå¸¸ä½æ•ˆï¼å¯ä»¥çœ‹åˆ°æ¨¡å‹è°ƒç”¨äº†å¤šæ¬¡ragï¼Œæ¯æ¬¡éƒ½è¦å¯¹å‘é‡æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ã€‚ä½†æ˜¯ä¿¡æ¯éƒ½åœ¨ragæ–‡æ¡£ä¸­çš„ä¸€å¥è¯ä¸­ï¼š 

> åŸæ–‡æ¡£å†…å®¹ï¼š
> ```
> YORO ä½œè€… mogu æ˜¯ä¸€ä¸ªç›®å‰å±…ä½åœ¨æ—¥æœ¬çš„ 23 å²ç¨‹åºå‘˜
> ```

### ä½¿ç”¨ YORO ç¤ºä¾‹
- **Q1**ï¼šYORO ä½œè€… mogu ä»Šå¹´å¤šå°‘å²ï¼Ÿ  
  â†’ æ¨¡å‹è°ƒç”¨ RAG æŸ¥è¯¢åˆ°ï¼šmogu ä»Šå¹´ 23 å²  
  â†’ åŒæ—¶å°†åŸæ–‡æ¡£å‘é‡åŒ–å¹¶å­˜å…¥ç¼“å­˜ï¼š


- **Q2**ï¼šYORO ä½œè€… mogu ç›®å‰å±…ä½åœ¨å“ªï¼Ÿ  
â†’ æ¨¡å‹æŸ¥è¯¢ç¼“å­˜ **å‘½ä¸­**ï¼Œç›´æ¥è¿”å›ï¼šmogu ç›®å‰åœ¨æ—¥æœ¬
- **Q3**ï¼šYORO ä½œè€… mogu æ˜¯ç¨‹åºå‘˜å—ï¼Ÿ  
â†’ æ¨¡å‹æŸ¥è¯¢ç¼“å­˜ **å‘½ä¸­**ï¼Œç›´æ¥è¿”å›ï¼šmogu æ˜¯ä¸€ä¸ªç¨‹åºå‘˜

âœ… é«˜æ•ˆåº”å¯¹çœŸå® RAG åœºæ™¯ï¼å‡å°‘é‡å¤æŸ¥è¯¢ï¼Œæé«˜å“åº”é€Ÿåº¦ï¼

---

## 2ï¸âƒ£ LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰æ›¿æ¢ç®—æ³•
YORO å†…ç½®äº† LRU ç¼“å­˜æ›¿æ¢ç®—æ³•ï¼Œçµæ„Ÿæ¥æºäºè®¡ç®—æœºå†…å­˜ç®¡ç†ï¼š

- å½“ç¼“å­˜å·²æ»¡ï¼Œéœ€è¦æ›¿æ¢æ—¶ï¼Œä¼˜å…ˆæ·˜æ±°æœ€è¿‘æ²¡æœ‰ä½¿ç”¨çš„ç¼“å­˜å—!
- æ¯ä¸ªç¼“å­˜å—éƒ½æœ‰ä¸€ä¸ªç±»ä¼¼è®¡ç®—æœºå†…å­˜çš„ **å­˜åœ¨ä½**ï¼Œåœ¨è°ƒå‡ºæ—¶è®¾ç½®ä¸º 0ï¼Œç±»ä¼¼è®¡ç®—æœºå†…å­˜çš„â€œæ— éœ€é‡å†™â€æœºåˆ¶

âš¡ **æ•ˆæœ**ï¼š
- ä¿æŒç¼“å­˜çš„é«˜å‘½ä¸­ç‡
- ä¸å®é™…ä½¿ç”¨åœºæ™¯é«˜åº¦å¥‘åˆ
- é¿å…æ— æ•ˆç¼“å­˜å ç”¨èµ„æº




> ğŸš€ YOROæ˜¯åŸºäº**LangChain** çš„é¡¹ç›®ï¼Œé›†æˆäº†**åŠ¨æ€ç‰¹å¾æ„ŸçŸ¥çš„ LRU ç¼“å­˜**ã€å’Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰â€”â€” ä¼˜åŒ–**é«˜æ•ˆè¯­ä¹‰å¤ç”¨**ã€‚

![Python](https://img.shields.io/badge/Python-3.10%2B-blue.svg?logo=python)
![LangChain](https://img.shields.io/badge/LangChain-âœ…-green?logo=chainlink)
![OpenAI](https://img.shields.io/badge/OpenAI-Embeddings-purple?logo=openai)
![License](https://img.shields.io/badge/license-MIT-orange)
![Status](https://img.shields.io/badge/status-Active-brightgreen)

---

## ğŸŒŸ ä¸»è¦ç‰¹æ€§

âœ… **RAG**
- ä½¿ç”¨ `InMemoryVectorStore` è¿›è¡Œè¯­ä¹‰æ£€ç´¢
- ä½¿ç”¨ `RecursiveCharacterTextSplitter` åµŒå…¥å’Œåˆ†å‰²å¤§å‹æ–‡æ¡£

âœ… **è‡ªå®šä¹‰è¯­ä¹‰ç¼“å­˜**
- LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰+ åŸºäºä½™å¼¦ç›¸ä¼¼åº¦çš„ç¼“å­˜
- æ™ºèƒ½ç¼“å­˜å‘½ä¸­æ£€æµ‹ï¼ˆå¯è°ƒèŠ‚ `threshold`ï¼‰
- å‡å°‘é‡å¤çš„åµŒå…¥å’Œæ£€ç´¢æˆæœ¬

---

## ğŸ§© ç³»ç»Ÿæ¶æ„

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªå¸¦æœ‰è¯­ä¹‰ç¼“å­˜ï¼ˆLRU + embedding ç›¸ä¼¼åº¦ï¼‰å’Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰çš„è½»é‡çº§æµæ°´çº¿ã€‚ä¸‹é¢æè¿°äº†ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ä¸è°ƒç”¨æµç¨‹ï¼ˆpipelineï¼‰ï¼š

### æ¦‚è§ˆ

- æ•°æ®é‡‡é›†ä¸åˆ†å‰²ï¼šä½¿ç”¨ `WebBaseLoader` æŠ“å–ç½‘é¡µå†…å®¹ï¼Œå¹¶ç”¨ `RecursiveCharacterTextSplitter` å°†é•¿æ–‡æ¡£åˆ‡æˆè‹¥å¹²è¯­ä¹‰å—ï¼ˆchunkï¼‰ï¼Œæ¯ä¸ª chunk ä¸ºæ£€ç´¢æœ€å°å•ä½ã€‚
- å‘é‡åŒ–ä¸ç´¢å¼•ï¼šå¯¹ chunk è¿›è¡ŒåµŒå…¥ï¼ˆ`OpenAIEmbeddings`ï¼‰ï¼Œå¹¶å­˜å…¥ `InMemoryVectorStore`ï¼ˆé¡¹ç›®ä¸­å¯æ›¿æ¢ä¸º FAISS/Annoy/å…¶ä»–æŒä¹…åŒ–å‘é‡åº“ï¼‰ã€‚
- å…³é”®è¯æ£€ç´¢ï¼ˆBM25ï¼‰ï¼šä½¿ç”¨ `rank_bm25.BM25Okapi` å¯¹ corpus åšå€’æ’æ£€ç´¢ï¼Œä»¥æä¾›é«˜ recall çš„å€™é€‰é›†åˆã€‚
- ç¨ å¯†æ£€ç´¢ï¼ˆDenseï¼‰ï¼šä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦ï¼ˆ`vector_store.similarity_search`ï¼‰åšè¯­ä¹‰æ£€ç´¢ï¼Œè¡¥å……æˆ–å¯¹æ¯” BM25 çš„å¬å›ç»“æœã€‚
- Dense é‡æ’ï¼ˆå¯é€‰ï¼‰ï¼šåœ¨ BM25/union å€™é€‰ä¸Šä½¿ç”¨ bi-encoder / cross-encoder å¯¹å€™é€‰åš rerankï¼Œæé«˜è¯­ä¹‰åŒ¹é…è´¨é‡ã€‚ï¼ˆç¤ºä¾‹å¯é€‰å®ç°ï¼šsentence-transformers çš„ `CrossEncoder` æˆ– `SentenceTransformer`ï¼‰
- è¯­ä¹‰ç¼“å­˜ï¼ˆSemanticCacheï¼ŒLRUï¼‰ï¼šå¯¹æœ€ç»ˆè¿”å›çš„åºåˆ—åŒ–ä¸Šä¸‹æ–‡è¿›è¡Œç¼“å­˜ï¼Œé‡‡ç”¨ embedding ç›¸ä¼¼åº¦åˆ¤å®šå‘½ä¸­ï¼Œç”¨äºå‡å°‘é‡å¤ RAG è°ƒç”¨ã€‚
- æ™ºèƒ½ä»£ç†ï¼ˆAgentï¼‰ï¼šåŸºäº LangGraph/LangChain çš„ agent è´Ÿè´£æ¥æ”¶ç”¨æˆ·è¾“å…¥ã€æŒ‰è§„åˆ™è°ƒç”¨ `retrieve_context`ï¼ˆæœ€å¤šä¸€æ¬¡ï¼‰å¹¶ä»¥ç»“æ„åŒ–æ ¼å¼è¾“å‡ºç»“æœã€‚

### æ•°æ®æµï¼ˆstep-by-stepï¼‰

1. ç”¨æˆ·å‘èµ·æŸ¥è¯¢ï¼ˆqueryï¼‰ã€‚
2. Agent è°ƒç”¨ `retrieve_context(query)`ï¼š
   - å…ˆæ£€æŸ¥ `SemanticCache.get(query)`ï¼ˆembedding ç›¸ä¼¼åº¦ + LRUï¼‰ï¼Œå‘½ä¸­ç›´æ¥è¿”å›ç¼“å­˜ç»“æœã€‚
   - ç¼“å­˜æœªå‘½ä¸­æ—¶åŒæ—¶è§¦å‘ï¼š
     - BM25 å¬å› top-Nï¼ˆä¾‹å¦‚ 50-100ï¼‰å€™é€‰ï¼ˆé«˜å¬å›ï¼‰ã€‚
     - å‘é‡æ£€ç´¢ï¼ˆDenseï¼‰å¬å› top-Mï¼ˆä¾‹å¦‚ 5-20ï¼‰å€™é€‰ï¼ˆè¯­ä¹‰å¬å›ï¼‰ã€‚
   - åˆå¹¶ BM25 ä¸ Dense å€™é€‰å¹¶å»é‡ï¼Œå¾—åˆ°å€™é€‰é›†åˆï¼ˆcandidate poolï¼‰ã€‚
   - å¯¹ candidate pool è¿›è¡Œ Dense é‡æ’ï¼ˆå¯é€‰ï¼‰ï¼š
     - è‹¥ä½¿ç”¨ bi-encoderï¼šå¯¹ query ä¸æ¯ä¸ª candidate çš„ embedding è®¡ç®—ç›¸ä¼¼åº¦å¹¶æ’åºï¼ˆå¿«é€Ÿã€å¯æ‰¹å¤„ç†ï¼‰ã€‚
     - è‹¥ä½¿ç”¨ cross-encoderï¼šå¯¹ (query, candidate) pair é€ä¸€è¯„åˆ†å¹¶æ’åºï¼ˆæ›´æ…¢ä½†é€šå¸¸æ›´å‡†ç¡®ï¼Œæ¨èå¯¹è¾ƒå°å€™é€‰é›†ä½¿ç”¨ï¼‰ã€‚
   - å–é‡æ’å top-Kï¼ˆä¾‹å¦‚ 5~10ï¼‰ç»“æœåºåˆ—åŒ–ä¸ºä¸Šä¸‹æ–‡ï¼Œå†™å…¥ `SemanticCache`ï¼Œè¿”å›ç»™ Agentã€‚
3. Agent å°†æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ä¸ç³»ç»Ÿ prompt ä¸€èµ·ä¼ ç»™ LLMï¼ˆeg. `gpt-4o-mini`ï¼‰ï¼Œå¹¶æŒ‰ `ResponseFormat` è¿”å›ç»“æ„åŒ–ç­”æ¡ˆã€‚

### å…³é”®ç»„ä»¶ä¸å¯¹åº”æ–‡ä»¶/ç±»

- Web åŠ è½½ä¸åˆ†å‰²ï¼š`WebBaseLoader` + `RecursiveCharacterTextSplitter`ï¼ˆåœ¨ `test.py` ä¸­ç¤ºä¾‹ä½¿ç”¨ï¼‰ã€‚
- Embeddings / å‘é‡å­˜å‚¨ï¼š`OpenAIEmbeddings` + `InMemoryVectorStore`ã€‚
- BM25 æ£€ç´¢ï¼š`BM25Okapi`ï¼ˆåŸºäº `simple_tokenize` çš„åˆ†è¯ç»“æœï¼‰ã€‚
- Dense rerankerï¼ˆå»ºè®®ï¼‰ï¼šä½¿ç”¨ `sentence-transformers` çš„ `CrossEncoder` æˆ– `SentenceTransformer` ä½œä¸º bi-encoderã€‚
- è¯­ä¹‰ç¼“å­˜ï¼š`SemanticCache`ï¼ˆLRU + embedding cosine åˆ¤å®šï¼‰å®ç°ä½äº `test.py`ï¼Œè´Ÿè´£ç¼“å­˜ query -> (serialized_context, docs) å¯¹ã€‚
- Agent é€»è¾‘ï¼šLangGraph / LangChain çš„ `create_agent` ä¸è‡ªå®šä¹‰ Toolsï¼ˆ`retrieve_context`, `search_web`ï¼‰ã€‚

### è®¾è®¡æ³¨æ„äº‹é¡¹ä¸è°ƒä¼˜å»ºè®®

- å€™é€‰è§„æ¨¡æ§åˆ¶ï¼šè·¨ç¼–ç å™¨ï¼ˆcross-encoderï¼‰é€‚åˆå°å€™é€‰æ± ï¼ˆ<=100ï¼‰ï¼Œbi-encoder å¯æ‰©å±•åˆ°æ›´å¤§æ± å¹¶ç»“åˆ FAISSã€‚ 
- åˆ†æ•°èåˆï¼šBM25 score ä¸ dense score å¤„äºä¸åŒå°ºåº¦ï¼Œæ¨èåšå½’ä¸€åŒ–åæŒ‰æƒé‡çº¿æ€§èåˆä»¥æå‡æ’åºç¨³å®šæ€§ã€‚
- ç¼“å­˜é˜ˆå€¼ï¼š`SemanticCache.threshold` å¯è°ƒï¼ˆç¤ºä¾‹ä»£ç ä¸­é»˜è®¤ 0.3ï¼‰ï¼Œç”Ÿäº§ç¯å¢ƒä¸­å¯é€šè¿‡ A/B æµ‹è¯•æˆ–ç¦»çº¿è¯„ä¼°è°ƒä¼˜ã€‚
- æˆæœ¬ä¸ååï¼šè‹¥ä½¿ç”¨ OpenAI åµŒå…¥/LLMï¼Œè¯·è€ƒè™‘é€Ÿç‡é™åˆ¶ä¸æˆæœ¬ï¼›å¯æŠŠ heavy rerank æ”¾åœ¨æœ¬åœ° `sentence-transformers` æ¨¡å‹æˆ–ç”¨æ›´å°æ¨¡å‹åšè£å‰ªã€‚

---

å¦‚éœ€æˆ‘æŠŠ `retrieve_context` ä¸­çš„ dense reranker å®ç°è¡¥ä¸Šå¹¶åœ¨ä»“åº“ä¸­æ·»åŠ ç¤ºä¾‹æ–‡ä»¶ï¼ˆ`rerank_dense.py`ï¼‰å¹¶åšä¸€æ¬¡ smoke-testï¼Œæˆ‘å¯ä»¥ç»§ç»­å®ç°å¹¶è¿è¡Œï¼ˆä¼šåŒ…å«å¯¹ `requirements.txt` çš„å»ºè®®ä¾èµ–ä¿®æ”¹ï¼‰ã€‚

## ğŸ§± é¡¹ç›®ç»“æ„

```plaintext
.
â”œâ”€â”€ ğŸš€ main.py                # å…¥å£ç‚¹ï¼ˆæ™ºèƒ½ä½“å¾ªç¯ï¼‰
â”œâ”€â”€ ğŸ“ .env                   # ç¯å¢ƒå˜é‡ï¼ˆOPENAI_API_KEYï¼‰
â”œâ”€â”€ ğŸ“¦ requirements.txt       # ä¾èµ–é¡¹
â”œâ”€â”€ ğŸ“– README.md             # æ–‡æ¡£è¯´æ˜
â””â”€â”€ ğŸ“‚ utils/
    â”œâ”€â”€ ğŸ§  semantic_cache.py  # è‡ªå®šä¹‰ LRU + åµŒå…¥ç¼“å­˜
    â””â”€â”€ ğŸ”„ loaders.py        # WebåŸºç¡€åŠ è½½å™¨
```

## âš™ï¸ å®‰è£…æ­¥éª¤

```bash
# 1ï¸âƒ£ å…‹éš†ä»“åº“
git clone https://github.com/yourusername/langgraph-rag-agent.git
cd langgraph-rag-agent

# 2ï¸âƒ£ åˆ›å»ºç¯å¢ƒ
python -m venv venv
# Windows:
venv\Scripts\activate
# Linux/Mac:
# source venv/bin/activate

# 3ï¸âƒ£ å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4ï¸âƒ£ è®¾ç½®ç¯å¢ƒå˜é‡
# åˆ›å»º .env æ–‡ä»¶å¹¶æ·»åŠ æ‚¨çš„ OpenAI API å¯†é’¥
echo "OPENAI_API_KEY=sk-xxxxxx" > .env
```

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | æè¿° |
|------|------|
| `SemanticCache` | åŸºäºåµŒå…¥ä½™å¼¦ç›¸ä¼¼åº¦çš„ LRU ç¼“å­˜ |
| `InMemoryVectorStore` | å­˜å‚¨åˆ†å‰²æ–‡æ¡£çš„å‘é‡æ•°æ®åº“ |
| `WebBaseLoader` | ç”¨äºæ£€ç´¢çš„ç½‘é¡µå†…å®¹çˆ¬å–å™¨ |
| `RecursiveCharacterTextSplitter` | å°†é•¿æ–‡æ¡£åˆ†å‰²ä¸ºè¯­ä¹‰å— |
| `ResponseFormat` | å¼ºåˆ¶å®æ–½ç»“æ„åŒ– LLM è¾“å‡ºçš„æ•°æ®ç±» |
| `InMemorySaver` | ç”¨äºå¯¹è¯çº¿ç¨‹çš„ LangGraph å†…å­˜æ£€æŸ¥ç‚¹ |

## ğŸ§© è¯­ä¹‰ç¼“å­˜ç¤ºä¾‹

```python
cache.stats()
# {'capacity': 128, 'entries': 7, 'threshold': 0.3}

# ç¼“å­˜å‘½ä¸­æ—¶ï¼š
[Cache] HIT (score=0.91) for query: "LangChain memory"...
```

## ğŸ§° ä¾èµ–é¡¹

| åº“ | ç‰ˆæœ¬ | ç”¨é€” |
|------|--------|---------|
| `langchain` | æœ€æ–°ç‰ˆ | æ™ºèƒ½ä½“å’Œå·¥å…·ç¼–æ’ |
| `langgraph` | æœ€æ–°ç‰ˆ | åŸºäºå›¾çš„æ™ºèƒ½ä½“æ‰§è¡Œ |
| `langchain_openai` | æœ€æ–°ç‰ˆ | åµŒå…¥å’ŒèŠå¤©æ¨¡å‹ |
| `numpy` | â‰¥1.25 | å‘é‡æ•°å­¦è®¡ç®— |
| `beautifulsoup4` | â‰¥4.12 | ç½‘é¡µè§£æ |
| `dotenv` | â‰¥1.0 | ç¯å¢ƒå˜é‡åŠ è½½ |

## ğŸ“¸ é¢„è§ˆ
![alt text](webquestion.png)
![alt text](terminalresponse.png)
### å¯ä»¥çœ‹åˆ°ï¼Œåœ¨é‡å¤è¾“å…¥ç±»ä¼¼ç›¸å…³é—®é¢˜æ—¶ï¼Œç›´æ¥è®¿é—®ç¼“å­˜ï¼Œé«˜æ•ˆä¾¿æ·

## Star History

[![Star History Chart](https://api.star-history.com/svg?repos=banwanmogu/YORO_CacheRag&type=date&legend=top-left)](https://www.star-history.com/#banwanmogu/YORO_CacheRag&type=date&legend=top-left)